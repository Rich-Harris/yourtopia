<html xmlns:py="http://genshi.edgewall.org/"
  xmlns:xi="http://www.w3.org/2001/XInclude">

  <py:def function="page_title">Home</py:def>

  <py:def function="optional_head">
    <script type='text/javascript' src='http://www.google.com/jsapi'></script>
    <!--script src="/static/vendor/protovis-r3.2.js"></script-->
    <!--script src="/static/countries.js"></script-->
    <script src="/static/app.js"></script>
    <script type="text/javascript">
var scores = ${scores_data};
google.load('visualization', '1', {'packages': ['geomap']});
google.setOnLoadCallback(drawMap);

function drawMap() {
  var data = new google.visualization.DataTable();
  data.addRows(scores.global.length);
  data.addColumn('string', 'Country');
  data.addColumn('number', 'Yourtopia score');
  for(var idx in scores.global) {
    var idx = parseInt(idx);
    data.setValue(idx, 0, scores.global[idx][2]);
    data.setValue(idx, 1, scores.global[idx][1]);
  }

  var options = {};
  options['dataMode'] = 'regions';
  options['colors'] = [0xFFFFFF, 0xA84542];

  var container = document.getElementById('worldmap');
  var geomap = new google.visualization.GeoMap(container);
  geomap.draw(data, options);
};

jQuery(function() {
  // OpenHDI.setupApp();

});
    </script>

    <style type="text/css">
#content .yourtopia {
  margin-top: 2em;
}

#content .yourtopia h1 {
  text-align: center;
  font-size: 150%;
}

#worldmap-outer {
  height: 430px;
  width: 750px;
  margin: auto;
}

.category-counts {
  width: 48%;
  float: left;
}

.chartlist li a {
  font-size: 90%;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
}

    </style>
  </py:def>

  <div py:def="content">
    <div class="yourtopia">
      <py:if test="not user_scores">
      <h1>You haven't yet taken the <a href="${url_for('quiz')}">quiz</a> so we can't tell which country is your(u)topia.</h1>
      </py:if>
      <py:if test="user_scores">
      <h1>The country closest to <strong>yourtopia</strong> (your utopia) is the ${user_scores[0][2]}</h1>

      <div id="worldmap-outer">
        <div id="worldmap"></div>
      </div>
      </py:if>
    </div>

    <py:def function="score_bar_chart(_scores)">
      <ul class="chartlist">
      <py:for each="code,v,country in _scores" py:with="divisor = _scores[0][1]">
        <li>
          <a href="#">${country}</a>
          <span class="count">${round(v/divisor, 2)}</span>
          <span class="index" style="width: ${100*v/divisor}%">${v/divisor}</span>
        </li>
      </py:for>
      </ul>
    </py:def>

    <div class="category-counts">
      <h3>Global Rankings (based on everybody's answers)</h3>
      ${score_bar_chart(global_scores)}
    </div>

    <py:if test="user_scores">
    <div class="category-counts">
      <h3>Your Rankings</h3>
      ${score_bar_chart(user_scores)}
    </div>
    </py:if>
  </div>

  <xi:include href="layout.html" />
</html>

