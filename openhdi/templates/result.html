<html xmlns:py="http://genshi.edgewall.org/"
  xmlns:xi="http://www.w3.org/2001/XInclude">

  <py:def function="page_title">Home</py:def>

  <py:def function="optional_head">
  
	<link rel="stylesheet" href="/static/chart.css" media="screen,print" title="Master stylesheet" charset="utf-8" />
    <script type='text/javascript' src='http://www.google.com/jsapi'></script>
    <script src="/static/vendor/protovis-r3.2.js"></script>
    <script src="/static/result.js"></script>
    <script src="/static/app.js"></script>
    <script type="text/javascript">
var global_scores = ${global_scores_json};
var scores = global_scores;
var user_scores = ${user_scores_json};
<py:if test="user_scores">
var scores = user_scores;
</py:if>

google.load('visualization', '1', {'packages': ['geomap']});
google.setOnLoadCallback(drawMap);
var sunburstWidth = 270;
var mapWidth = 430;

function drawMap() {
  var data = new google.visualization.DataTable();
  data.addRows(scores.length);
  data.addColumn('string', 'Country');
  data.addColumn('number', 'Yourtopia score');
  for(var idx in scores) {
    var idx = parseInt(idx);
    data.setValue(idx, 0, scores[idx][0]);
    data.setValue(idx, 1, scores[idx][1]);
  }

  var options = {};
  options['dataMode'] = 'regions';
  options['colors'] = [0xcb4b4b, 0xedc240, 0x89c141];
  options['width'] = mapWidth + 'px';
  options['height'] = mapWidth / 556 * 347 + 'px';

  var container = document.getElementById('worldmap');
  var geomap = new google.visualization.GeoMap(container);
  geomap.draw(data, options);
};

var weights = ${weights};
jQuery(function() {
    yourtopiaSunburst()
});
    </script>

    <style type="text/css">
#content .yourtopia {
  margin-top: 0.5em;
  margin-bottom: 1.5em;
}

#content .yourtopia h1 {
  text-align: center;
  font-size: 150%;
}

#worldmap-outer {
  /* must be same as set directly on map widget in js */
  width: 400px;
  float: left;
}

#weights-outer {
  width: 350px;
  float: right;
}

.category-counts {
  width: 48%;
  float: left;
  padding-right: 2%;
}

ul.chartlist {
  width: 98%;
}

.chartlist li a {
  font-size: 90%;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
}

.clear {
  clear: both;
}
    </style>
  </py:def>

  <div py:def="content">
    <div class="yourtopia" style="width: 765px; border: dashed 1px #999999; background-color: #D5DFFF; padding: 2%">
      <py:if test="user_scores">
      <div style="color: #333333">The country closest to <strong>YourTopia</strong> (your utopia) is <strong>${user_scores[0][2]}</strong></div>
      </py:if>
      <py:if test="not user_scores">
      <h1>WorldTopia! YourTopia Based on the <strong>Average</strong></h1>
      </py:if>
    </div>

	<div style="background-color: #e2e2e2; float: left; width: 800px; border: dashed 1px #999999">
         <div style="padding:2%; float: left">Your <strong>preferred countries</strong> and <strong>weighting scheme</strong><div id="worldmap" style="background-color: #eaf7fe; border: dashed 1px #999999;"></div></div>
		<div style="padding:2%; float: right; padding-top: 40px"><div id="weights"></div></div>
    </div>	
	
    <div class="clear"></div>

    <py:def function="score_bar_chart(_scores)">
      <ul class="chartlist">
      <py:for each="idx, (code,v,country) in enumerate(_scores)">
        <li>
          <a href="http://en.wikipedia.org/wiki/${country}" target="_blank">${idx+1}. ${country}</a>
          <span class="count">${v}</span>
          <span class="index" style="width: ${100*v}%">${v}</span>
        </li>
      </py:for>
      </ul>
    </py:def>

	<br />
	<div style="width: 765px; float: left; background-color:#f0f0f0; padding: 2%; border: dashed 1px #999999">
    <py:if test="not user_scores">
    <div>
      <strong>Global Rankings</strong>
      ${score_bar_chart(global_scores)}
    </div>
    </py:if>
	
    <py:if test="user_scores">
    <div style="width: 300px; float: left">
      <strong>Global Rankings</strong>
      ${score_bar_chart(global_scores)}
    </div>

    <div  style="width: 300px; float: right">
      <strong>Your Rankings</strong>
      ${score_bar_chart(user_scores)}
    </div>
    </py:if>
	</div>

</div>

  <xi:include href="layout.html" />
</html>

