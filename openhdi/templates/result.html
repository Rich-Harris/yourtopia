<html xmlns:py="http://genshi.edgewall.org/"
  xmlns:xi="http://www.w3.org/2001/XInclude">

  <py:def function="page_title">Home</py:def>

  <py:def function="optional_head">
    <script src="/static/vendor/protovis-r3.2.js"></script>
    <script src="/static/countries.js"></script>
    <script src="/static/app.js"></script>
    <script type="text/javascript">
var scores = ${scores_data};
jQuery(function() {
  OpenHDI.setupApp();
});
    </script>

    <style type="text/css">
.category-counts {
  width: 40%;
  float: left;
}

#worldmap {
  height: 430px;
}
    </style>
  </py:def>

  <div py:def="content">
    <p>Based on your answers to our question the country closed to your
    utopia (yourtopia!) is <strong>${user_scores[0][2]}</strong>.</p>

    <div id="worldmap"></div>

    <py:def function="score_bar_chart(_scores)">
      <ul class="chartlist">
      <py:for each="code,v,country in _scores" py:with="divisor = _scores[0][1]">
        <li>
          <a href="#">${country}</a>
          <span class="count">${round(v/divisor, 2)}</span>
          <span class="index" style="width: ${100*v/divisor}%">${v/divisor}</span>
        </li>
      </py:for>
      </ul>
    </py:def>

    <div class="category-counts">
      <h3>Your Rankings</h3>
      ${score_bar_chart(user_scores)}
    </div>

    <div class="category-counts">
      <h3>Global Rankings</h3>
      ${score_bar_chart(global_scores)}
    </div>


  <script type="text/javascript+protovis">
var fill = pv.Scale.linear()
    .domain(0, 1)
    .range("#ffffff", "#333333");

/* Precompute the country's population density and color. */
countries.forEach(function(c) {
  c.color = scores.user[2007][c.code]
      ? fill(scores.user[2007][c.code])
      : "#ccc"; // unknown
});

var w = 700,
    h = 3 / 5 * w,
    geo = pv.Geo.scale("identity").range(w, h);

var vis = new pv.Panel()
  .width(w)
  .height(h)
  .canvas('worldmap')
  ;

/* Countries. */
vis.add(pv.Panel)
    .data(countries)
  .add(pv.Panel)
    .data(function(c) c.borders)
  .add(pv.Line)
    .data(function(b) b)
    .left(geo.x)
    .top(geo.y)
    .title(function(d, b, c) c.name)
    .fillStyle(function(d, b, c) c.color)
    .lineWidth(0)
    .antialias(true);

vis.render();
    </script>

  </div>

  <xi:include href="layout.html" />
</html>

